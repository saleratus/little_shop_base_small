<%= tag.div id: "order-#{@order.id}" do %>
  <p>Order ID <%= @order.id %></p>
  <p>Created: <%= @order.created_at %></p>
  <p>Last Update: <%= @order.last_update %></p>
  <p>Status: <%= @order.status %></p>
  <p>Item Count: <%= @order.total_item_count %></p>
  <p>Total Cost: <%= number_to_currency(@order.total_cost) %></p>

  <% if @order.status == 'pending' %>
  <p><%= button_to 'Cancel Order', profile_order_path(@order), method: :delete %></p>
  <% end %>

  <% @order.order_items.each do |oitem| %>
    <%= tag.div id: "oitem-#{oitem.id}" do %>
      <%= render partial: "/profile/orders/order_item", locals: {oitem: oitem, img_width: 150} %>
      <%= "Average Score: #{oitem.avg_rating_score}" %>
      <% if @order.status == 'completed' %>
        <% rating = oitem.enabled_rating %>
        <% if rating %>
          <%= "Your Rating: #{rating.title} #{rating.description} Score: #{rating.score}" %>
          <p><%= button_to 'Edit rating', edit_profile_rating_path(rating), method: :get %></p>
          <p><%= button_to 'Delete rating', profile_disable_rating_path(rating), method: :patch %></p>
        <% else %>
          <p><%= button_to 'Rate this item', new_profile_rating_path(order_item_id: oitem.id), method: :get %></p>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
